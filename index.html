<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quantum Computing Study Lab</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<!-- ── Markdown‑it + highlight.js ───────────────────────── -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/styles/atom-one-dark.min.css">
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
<!-- Add MathJax for LaTeX rendering -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>

<!-- -----------------  DESIGN TOKENS  ----------------- -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

:root{
  /* Quantum-inspired color palette - Dark Mode */
  --brand:#8b5cf6;      --brand-h:#a78bfa;
  --brand-gradient:linear-gradient(135deg, #8b5cf6 0%, #06b6d4 100%);
  --bg:#0c0c14;         --bg-h:#141420;
  --card:#1a1a2e;       --card-h:#252540;
  --text:#f1f5f9;       --text-sub:#a1a1aa;
  --border:#2d2d44;
  --green:#10b981;      --red:#ef4444;
  --radius:0.875rem;
  --shadow:0 4px 20px rgba(0,0,0,0.3);
}

/* Light Mode */
html.light{
  --bg:#f8fafc;  --bg-h:#f1f5f9;
  --card:#ffffff;--card-h:#f1f5f9;
  --text:#1e1e2e;--text-sub:#64748b;
  --border:#e2e8f0;
  --shadow:0 4px 20px rgba(0,0,0,0.08);
}

*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
html,body{height:100%}

body{
  font:400 1rem/1.6 'Inter',system-ui,-apple-system,sans-serif;
  background:var(--bg);color:var(--text);display:flex;flex-direction:column;
  -webkit-font-smoothing:antialiased;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Subtle gradient accent at top */
body::before{
  content:'';position:fixed;top:0;left:0;right:0;height:300px;
  background:linear-gradient(180deg, rgba(139, 92, 246, 0.08) 0%, transparent 100%);
  pointer-events:none;z-index:0;
}
html.light body::before{
  background:linear-gradient(180deg, rgba(139, 92, 246, 0.05) 0%, transparent 100%);
}

pre code{
  display:block;
  overflow-x:auto;
  padding:1.25rem;
  border-radius:var(--radius);
  background:#1e1e2e;
  font-family:'JetBrains Mono',monospace;
  font-size:.875rem;
  border:1px solid var(--border);
}
html.light pre code{
  background:#f8fafc;
}

/* ---------- nav ---------- */
nav{
  position:fixed;top:0;left:0;right:0;z-index:200;
  background:var(--card);
  display:flex;
  align-items:center;
  border-bottom:1px solid var(--border);
  padding:0.5rem;
  gap:0.25rem;
}
nav .nav-buttons{
  display:flex;
  flex:1;
  gap:0.25rem;
}
nav button{
  flex:1;padding:0.75rem 0.5rem;
  background:transparent;
  border:none;
  border-radius:calc(var(--radius) - 4px);
  font-weight:600;
  font-size:0.875rem;
  color:var(--text-sub);
  cursor:pointer;
  transition:all 0.2s ease;
}
nav button:hover{
  color:var(--text);
  background:var(--bg-h);
}
nav button.active{
  color:#fff;
  background:var(--brand);
}

/* Theme Toggle in nav */
nav .theme-toggle{
  display:flex;
  align-items:center;
  background:var(--bg-h);
  padding:3px;
  border-radius:50px;
  border:1px solid var(--border);
  margin-left:0.5rem;
}
nav .theme-toggle button{
  flex:none;
  display:flex;
  align-items:center;
  justify-content:center;
  width:32px;
  height:32px;
  padding:0;
  border:none;
  border-radius:50%;
  background:transparent;
  color:var(--text-sub);
  cursor:pointer;
  transition:all 0.2s ease;
}
nav .theme-toggle button.active{
  background:var(--brand);
  color:#fff;
  box-shadow:0 2px 8px rgba(139, 92, 246, 0.4);
}
nav .theme-toggle button:hover:not(.active){
  color:var(--text);
  background:var(--card-h);
}
nav .theme-toggle svg{
  width:16px;
  height:16px;
}

main{flex:1;padding:1.5rem;padding-top:70px;display:flex;justify-content:center;position:relative;z-index:1}
.view{display:none;width:100%;max-width:800px;margin:auto;animation:fadeIn 0.3s ease}
.view.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* Buttons */
.btn{
  border-radius:var(--radius);font-weight:600;font-size:0.9rem;padding:0.7rem 1.4rem;
  display:inline-flex;align-items:center;justify-content:center;gap:0.4rem;
  transition:all 0.2s ease;cursor:pointer;border:none;
}
.fill{
  background:var(--brand);color:#fff;
}
.fill:hover{
  background:var(--brand-h);
  transform:translateY(-1px);
  box-shadow:0 4px 12px rgba(139, 92, 246, 0.3);
}
.neutral{
  background:var(--card-h);
  color:var(--text);
  border:1px solid var(--border);
}
.neutral:hover{
  background:var(--bg-h);
  border-color:var(--brand);
}
.ghost{
  background:transparent;
  color:var(--brand);
  border:1px solid var(--brand);
}
.ghost:hover{
  background:var(--brand);
  color:#fff;
}

/* Flashcards */
.card-box{perspective:1200px;width:100%;max-width:520px;margin:0 auto 1.5rem}
.card{
  position:relative;width:100%;min-height:260px;
  border-radius:var(--radius);
  background:var(--card);
  border:1px solid var(--border);
  transform-style:preserve-3d;
  transition:transform 0.6s cubic-bezier(0.4,0,0.2,1);
  display:flex;align-items:center;justify-content:center;
  padding:2rem;text-align:center;font-size:1.1rem;font-weight:500;
  box-shadow:var(--shadow);
  cursor:pointer;
}
.card:hover{
  border-color:var(--brand);
}
.card.flipped{transform:rotateY(180deg)}
.side{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  padding:2rem;backface-visibility:hidden;
  border-radius:var(--radius);
}
.front{background:var(--card)}
.back{transform:rotateY(180deg);background:var(--card)}
.row{display:flex;gap:0.75rem;flex-wrap:wrap;justify-content:center;margin-top:1rem}

/* MCQ */
.block{
  margin-bottom:2rem;display:flex;flex-direction:column;gap:1rem;
  background:var(--card);
  padding:1.5rem;
  border-radius:var(--radius);
  border:1px solid var(--border);
  box-shadow:var(--shadow);
}
.block > p:first-child{
  font-size:1.05rem;
  font-weight:600;
  color:var(--text);
}
.option{
  width:100%;padding:1rem 1.25rem;
  border-radius:calc(var(--radius) - 4px);
  background:var(--bg-h);
  border:1px solid var(--border);
  color:var(--text);text-align:left;font:inherit;
  cursor:pointer;transition:all 0.2s ease;
}
.option:hover:not(.disabled){
  background:var(--card-h);
  border-color:var(--brand);
}
.option.disabled{cursor:not-allowed;opacity:0.7}
.correct{
  background:rgba(16, 185, 129, 0.15)!important;
  border-color:var(--green)!important;
  color:var(--green)!important;
}
.wrong{
  background:rgba(239, 68, 68, 0.15)!important;
  border-color:var(--red)!important;
  color:var(--red)!important;
}

/* textarea */
textarea{
  width:100%;min-height:140px;padding:1rem;
  background:var(--bg-h);
  border-radius:var(--radius);
  border:1px solid var(--border);
  resize:vertical;color:var(--text);
  font-family:'Inter',sans-serif;
  font-size:1rem;
  transition:all 0.2s ease;
}
textarea:focus{
  outline:none;
  border-color:var(--brand);
  box-shadow:0 0 0 3px rgba(139, 92, 246, 0.15);
}
textarea::placeholder{color:var(--text-sub)}

/* notes */
.notes{
  background:var(--card);
  padding:2rem;
  border-radius:var(--radius);
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  line-height:1.7;
}

.notes h1{
  font-size:2rem;font-weight:800;margin:0 0 1rem;
  background:var(--brand-gradient);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}
.notes h2{
  font-size:1.5rem;font-weight:700;margin:1.5rem 0 0.75rem;
  color:var(--brand);
}
.notes h3{font-size:1.2rem;font-weight:600;margin:1rem 0 0.5rem;color:var(--brand-h)}
.notes h4{font-size:1.05rem;font-weight:600;margin:1rem 0 0.4rem}

.notes ul,.notes ol{margin-left:1.25rem;padding-left:0.5rem}
.notes ul ul,.notes ol ol{margin-left:1rem}
.notes ul li{list-style:disc}
.notes ul ul li{list-style:circle}
.notes hr{border:0;height:1px;background:var(--border);margin:1.5rem 0}
.notes a{color:var(--brand);text-decoration:none}
.notes a:hover{text-decoration:underline}
.notes strong{color:var(--brand)}
.notes code:not(pre code){
  background:var(--bg-h);
  padding:0.15em 0.4em;
  border-radius:4px;
  font-family:'JetBrains Mono',monospace;
  font-size:0.875em;
  color:var(--brand-h);
}

/* collapsible animation */
.collapsible{
  max-height:0;overflow:hidden;
  transition:max-height 0.3s ease,opacity 0.3s ease,padding 0.3s ease;
  opacity:0;
  border-radius:0 0 var(--radius) var(--radius);
  background:var(--bg-h);
  padding:0 1rem;
  border:1px solid var(--border);
  border-top:none;
  font-weight:500;
}
.collapsible.expanded{max-height:1000px;opacity:1;padding:1rem}
.accordion{margin-bottom:1rem}
.toggle-btn{
  display:flex;align-items:center;gap:0.5rem;width:100%;text-align:left;
  font-weight:600;transition:all 0.2s;
  background:var(--bg-h);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:0.875rem 1rem;
  cursor:pointer;
}
.toggle-btn:hover{border-color:var(--brand)}
.toggle-btn.active{border-radius:var(--radius) var(--radius) 0 0;border-bottom:none;border-color:var(--brand)}
.toggle-btn::after{
  content:"▼";transition:transform 0.3s ease;
  margin-left:auto;font-size:0.7rem;color:var(--brand);
}
.toggle-btn.active::after{transform:rotate(180deg)}

/* floating selection btn */
#selAsk{
  position:fixed;
  z-index:2147483647;
  display:none;
  padding:0.6rem 1rem;
  background:var(--brand);
  color:#fff;
  border:0;
  border-radius:var(--radius);
  font-weight:600;
  font-size:0.875rem;
  box-shadow:0 4px 12px rgba(139, 92, 246, 0.4);
  align-items:center;
  justify-content:center;
  pointer-events:auto;
  cursor:pointer;
}

/* Score display */
#mcqScore{
  color:var(--brand);
  font-size:1.2rem;
}

/* Scrollbar styling */
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{
  background:var(--card-h);
  border-radius:4px;
}
::-webkit-scrollbar-thumb:hover{background:var(--brand)}

/* Card counter */
.card-counter{
  text-align:center;
  color:var(--text-sub);
  font-size:0.875rem;
  margin-bottom:0.75rem;
}
</style>
</head>

<body>
<nav>
  <div class="nav-buttons">
    <button data-view="flash" class="active">Flashcards</button>
    <button data-view="mcq">Quiz</button>
    <button data-view="written">Written</button>
    <button data-view="tf">True/False</button>
    <button data-view="notes">Notes</button>
  </div>
  <div class="theme-toggle">
    <button id="darkBtn" class="active" aria-label="Dark mode">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>
    </button>
    <button id="lightBtn" aria-label="Light mode">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
      </svg>
    </button>
  </div>
</nav>

<main>
  <!-- FLASHCARDS -->
  <section id="flash" class="view active">
    <p class="card-counter" id="fcCounter"></p>
    <div class="card-box">
      <div class="card" id="fcCard">
        <div class="side front" id="fcQ"></div>
        <div class="side back" id="fcA"></div>
      </div>
    </div>
    <div class="row"><button id="fcPrev" class="btn neutral">← Previous</button><button id="fcNext" class="btn fill">Next →</button></div>
    <div class="row"><button id="fcAsk" class="btn ghost">Ask ChatGPT</button></div>
  </section>

  <!-- MCQ -->
  <section id="mcq" class="view"><div id="mcqWrap"></div><p id="mcqScore" style="font-weight:700;text-align:center"></p></section>

  <!-- WRITTEN -->
  <section id="written" class="view">
    <div class="block">
      <p id="waQ"></p>
      <textarea id="waInput" placeholder="Enter your answer here…"></textarea>

      <div class="accordion">
        <button id="waToggle" class="btn toggle-btn">Reveal Answer</button>
        <div id="waA" class="collapsible"></div>
      </div>

      <div class="row"><button id="waPrev" class="btn neutral">← Previous</button><button id="waNext" class="btn fill">Next →</button></div>
      <div class="row"><button id="waAsk" class="btn ghost">Ask ChatGPT</button></div>
    </div>
  </section>

  <!-- TRUE/FALSE -->
  <section id="tf" class="view">
    <div class="block">
      <p id="tfQ"></p>
      <div class="row"><button class="btn option" data-val="true">True</button><button class="btn option" data-val="false">False</button></div>
      <div class="row"><button id="tfPrev" class="btn neutral">← Previous</button><button id="tfNext" class="btn fill">Next →</button></div>
      <div class="row"><button id="tfAsk" class="btn ghost">Ask ChatGPT</button></div>
    </div>
  </section>

  <!-- NOTES -->
  <section id="notes" class="view"><article id="notesBox" class="notes">Loading…</article></section>
</main>

<button id="selAsk">Ask ChatGPT</button>

<!-- ----------------------- APP ----------------------- -->
<script>
/* ---------- markdown‑it + highlight helper ---------- */
const md = window.markdownit({
  html: true,
  linkify: true,
  typographer: true,
  breaks: true
});
function renderMD(el, src){
  el.innerHTML = md.render(src);
  if (window.MathJax){
    if (typeof MathJax.typesetPromise === 'function') MathJax.typesetPromise();
    else if (typeof MathJax.typeset === 'function') MathJax.typeset();
  }
  if (window.hljs) hljs.highlightAll();
}

const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}};
const ask=p=>window.open('https://chatgpt.com/?model=gpt-4o&temporary-chat=true&q='+encodeURIComponent(p),'_blank');
const dataPromise=fetch('data.json').then(r=>r.json());

/* ---------- theme toggle ---------- */
const darkBtn = $('#darkBtn');
const lightBtn = $('#lightBtn');

const applyTheme = mode => {
  document.documentElement.classList.toggle('light', mode === 'light');
  darkBtn.classList.toggle('active', mode === 'dark');
  lightBtn.classList.toggle('active', mode === 'light');
  localStorage.theme = mode;
};

applyTheme(localStorage.theme || 'dark');
darkBtn.onclick = () => applyTheme('dark');
lightBtn.onclick = () => applyTheme('light');

/* ---------- nav switching + clear selection ---------- */
$$('nav .nav-buttons button').forEach(btn=>btn.onclick=()=>{$('nav .nav-buttons .active').classList.remove('active');btn.classList.add('active');$('.view.active').classList.remove('active');$('#'+btn.dataset.view).classList.add('active');getSelection().removeAllRanges();$('#selAsk').style.display='none';});

/* ——— SWIPE SUPPORT ——— */
function addSwipe(el,onLeft,onRight){
  let sx=0,sy=0;const thresh=50,restraint=100;
  el.addEventListener('touchstart',e=>{
    const t=e.changedTouches[0];sx=t.pageX;sy=t.pageY;
  },{passive:true});
  el.addEventListener('touchend',e=>{
    const t=e.changedTouches[0];
    const dx=t.pageX-sx,dy=t.pageY-sy;
    if(Math.abs(dx)>=thresh&&Math.abs(dy)<=restraint){
      dx<0?onLeft&&onLeft():onRight&&onRight();
    }
  },{passive:true});
}

/* ---------- FLASHCARDS ---------- */
(async()=>{
 const arr=(await dataPromise).flashcards;shuffle(arr);let i=0;
 const card=$('#fcCard'),q=$('#fcQ'),a=$('#fcA'),counter=$('#fcCounter');
 const render=()=>{
   const c=arr[i];
   renderMD(q, c.q);
   renderMD(a, c.a);
   card.classList.remove('flipped');
   counter.textContent = `${i+1} / ${arr.length}`;
 };
 render();
 card.onclick=()=>card.classList.toggle('flipped');
 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#fcPrev').onclick=prev;
 $('#fcNext').onclick=next;
 addSwipe($('#flash'),next,prev);
 $('#fcAsk').onclick=()=>ask(`Explain the following quantum computing concept in simple terms:\n"${arr[i].q}"`);
})();

/* ---------- MCQ ---------- */
(async()=>{
 const arr=(await dataPromise).multipleChoice;shuffle(arr);
 const wrap=$('#mcqWrap'),score=$('#mcqScore');let sc=0;
 arr.forEach((q,idx)=>{
  shuffle(q.choices);
  const blk=document.createElement('div');blk.className='block';blk.innerHTML=`<p>${idx+1}. ${q.question}</p>`;
  const optWrap=document.createElement('div');optWrap.style.display='grid';optWrap.style.gap='0.5rem';
  const opts=[];
  q.choices.forEach(c=>{
    const btn=document.createElement('button');btn.className='btn option';btn.textContent=c;
    btn.onclick=()=>{
      opts.forEach(o=>{o.disabled=true;o.classList.add('disabled')});
      btn.classList.add(c===q.answer?'correct':'wrong');
      if(c===q.answer)sc++;else opts.find(o=>o.textContent===q.answer).classList.add('correct');
      score.textContent=`Score: ${sc}/${arr.length}`;
    };
    opts.push(btn);optWrap.appendChild(btn);
  });
  const askBtn=document.createElement('button');askBtn.className='btn ghost';askBtn.textContent='Ask ChatGPT';
  askBtn.style.marginTop='0.5rem';
  askBtn.onclick=()=>ask(`Quantum computing multiple-choice question:\n${q.question}\nOptions: ${q.choices.join(', ')}\nExplain why the correct answer ("${q.answer}") is right and others are wrong.`);
  blk.append(optWrap,askBtn);wrap.appendChild(blk);
 });
})();

/* ---------- WRITTEN ---------- */
(async()=>{
 const arr=(await dataPromise).writtenAnswer;shuffle(arr);let i=0;
 const q=$('#waQ'),aBox=$('#waA'),tBtn=$('#waToggle');

 const render=()=>{
   renderMD(q, arr[i].q);
   aBox.innerHTML='';
   aBox.classList.remove('expanded');
   tBtn.classList.remove('active');
   tBtn.textContent='Reveal Answer';
 };
 render();

 tBtn.onclick=()=>{
   const expanded=aBox.classList.contains('expanded');
   if(!expanded) renderMD(aBox, arr[i].a);
   aBox.classList.toggle('expanded');
   tBtn.classList.toggle('active');
 };

 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#waPrev').onclick=prev;
 $('#waNext').onclick=next;
 addSwipe($('#written'),next,prev);
 $('#waAsk').onclick=()=>ask(`I'm studying quantum computing. Could you explain the following question for me?\n"${arr[i].q}"\n\nThe correct answer is: "${arr[i].a}"`);
})();

/* ---------- TRUE/FALSE ---------- */
(async()=>{
 const arr=(await dataPromise).trueFalse;shuffle(arr);let i=0;
 const q=$('#tfQ'),btns=$$('#tf button.option');
 const render=()=>{
   renderMD(q, arr[i].q);
   btns.forEach(b=>{b.disabled=false;b.classList.remove('correct','wrong','disabled')});
 };
 btns.forEach(b=>b.onclick=()=>{
  const ans=b.dataset.val==='true',ok=arr[i].a;
  btns.forEach(x=>{x.disabled=true;x.classList.add('disabled')});
  b.classList.add(ans===ok?'correct':'wrong');
 });
 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#tfPrev').onclick=prev;
 $('#tfNext').onclick=next;
 addSwipe($('#tf'),next,prev);
 $('#tfAsk').onclick=()=>ask(`Is the following statement about quantum computing true or false? Explain.\n"${arr[i].q}"\n\nThe correct answer is: ${arr[i].a ? "True" : "False"}`);
 render();
})();

/* ---------- NOTES + floating ask ---------- */
(async()=>{
  const box = $('#notesBox');
  renderMD(box, await (await fetch('notes.md')).text());
  const float = $('#selAsk');
  float.style.display = 'none';
  const isMobile = window.matchMedia('(pointer: coarse)').matches;
  let currentSelText = '';

  const updateFloatPosition = () => {
    const sel = getSelection();
    if (!sel || sel.isCollapsed || !$('#notesBox').contains(sel.anchorNode)) {
      float.style.display = 'none';
      currentSelText = '';
      return;
    }
    currentSelText = sel.toString().trim();
    const r = sel.getRangeAt(0).getBoundingClientRect();
    float.style.position = 'fixed';
    const extra = isMobile ? 36 : 20;
    float.style.top = `${r.bottom + extra}px`;
    float.style.left = `${r.left}px`;
    float.style.display = 'flex';
    const fr = float.getBoundingClientRect();
    const vw = document.documentElement.clientWidth;
    if (fr.right > vw) float.style.left = `${vw - fr.width - 10}px`;
  };

  const askSelection = () => {
    if (currentSelText)
      ask(`Explain this excerpt from my quantum computing notes:\n"${currentSelText}"`);
  };

  float.addEventListener('click', e => { e.preventDefault(); askSelection(); });
  if (isMobile) {
    float.addEventListener('touchend', e => { e.preventDefault(); askSelection(); });
  } else {
    float.addEventListener('mousedown', e => { e.preventDefault(); askSelection(); });
  }

  document.addEventListener('selectionchange', updateFloatPosition);
  document.addEventListener('touchend', () => setTimeout(updateFloatPosition, 100));
  document.addEventListener('scroll', () => {
    if (getSelection() && !getSelection().isCollapsed) updateFloatPosition();
  });
  window.addEventListener('resize', () => {
    if (getSelection() && !getSelection().isCollapsed) updateFloatPosition();
  });
})();
</script>
</body>
</html>
