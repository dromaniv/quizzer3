<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quantum Computing Study Lab</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<!-- ‚îÄ‚îÄ Markdown‚Äëit + highlight.js ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/styles/atom-one-dark.min.css">
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
<!-- Add MathJax for LaTeX rendering -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>

<!-- -----------------  DESIGN TOKENS  ----------------- -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

:root{
  /* Quantum-inspired color palette */
  --brand:#8b5cf6;      --brand-h:#7c3aed;
  --brand-gradient:linear-gradient(135deg, #8b5cf6 0%, #06b6d4 50%, #10b981 100%);
  --brand-gradient-2:linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #06b6d4 100%);
  --bg:#0a0a0f;         --bg-h:#12121a;
  --card:rgba(20, 20, 35, 0.8);       --card-h:rgba(30, 30, 50, 0.9);
  --text:#f1f5f9;       --text-sub:#94a3b8;
  --border:rgba(139, 92, 246, 0.2);
  --green:#10b981;      --red:#ef4444;
  --radius:1rem;        --shadow:0 8px 32px rgb(139 92 246/.15);
  --transition-speed: 0.3s;
  --glow: 0 0 20px rgba(139, 92, 246, 0.4), 0 0 40px rgba(6, 182, 212, 0.2);
  --glass: rgba(255, 255, 255, 0.05);
}
/* dark mode is default - light mode for those who prefer */
html.light{
  --bg:#f8fafc;  --bg-h:#e2e8f0;
  --card:rgba(255,255,255,0.9);--card-h:rgba(241,245,249,0.95);
  --text:#0f172a;--text-sub:#475569;
  --border:rgba(139, 92, 246, 0.3);
  --shadow:0 8px 32px rgb(139 92 246/.1);
  --glass: rgba(255, 255, 255, 0.7);
}
*{box-sizing:border-box;margin:0;padding:0} html,body{height:100%}
body{
  font:400 1rem/1.6 'Inter',system-ui,-apple-system,sans-serif;
  background:var(--bg);color:var(--text);display:flex;flex-direction:column;
  -webkit-font-smoothing:antialiased;
  overflow-x:hidden;
}

/* Animated background */
body::before{
  content:'';position:fixed;inset:0;z-index:-2;
  background:var(--bg);
}
body::after{
  content:'';position:fixed;inset:0;z-index:-1;
  background:
    radial-gradient(ellipse 80% 50% at 20% 40%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
    radial-gradient(ellipse 60% 40% at 80% 60%, rgba(6, 182, 212, 0.12) 0%, transparent 50%),
    radial-gradient(ellipse 50% 30% at 50% 90%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
  animation: bgPulse 8s ease-in-out infinite alternate;
}
@keyframes bgPulse{
  0%{opacity:.6;transform:scale(1)}
  100%{opacity:1;transform:scale(1.05)}
}

/* Floating particles */
.particles{position:fixed;inset:0;z-index:-1;overflow:hidden;pointer-events:none}
.particle{
  position:absolute;width:4px;height:4px;
  background:var(--brand);border-radius:50%;
  opacity:0;animation:float 15s infinite;
}
@keyframes float{
  0%{opacity:0;transform:translateY(100vh) scale(0)}
  10%{opacity:.6}
  90%{opacity:.6}
  100%{opacity:0;transform:translateY(-100vh) scale(1)}
}

pre code{
  display:block;
  overflow-x:auto;
  padding:1.25rem;
  border-radius:var(--radius);
  background:rgba(15,15,25,0.9);
  font-family:'JetBrains Mono',monospace;
  font-size:.9rem;
  border:1px solid var(--border);
}

/* ---------- header & theme switch ---------- */
header{
  padding:1.25rem 2rem;
  background:var(--glass);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  display:flex;justify-content:space-between;align-items:center;
  color:var(--text);
  border-bottom:1px solid var(--border);
  z-index:200;
  position:relative;
}
header::before{
  content:'';position:absolute;bottom:0;left:0;right:0;height:1px;
  background:var(--brand-gradient);
  opacity:.5;
}
header h1{
  font-size:1.4rem;font-weight:700;
  background:var(--brand-gradient);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  display:flex;align-items:center;gap:.6rem;
}
header h1::before{
  content:'‚öõ';font-size:1.6rem;
  -webkit-text-fill-color:#8b5cf6;
  animation:spin 4s linear infinite;
}
@keyframes spin{
  from{transform:rotate(0deg)}to{transform:rotate(360deg)}
}
.switch{
  --w:56px;--h:30px;position:relative;display:inline-block;width:var(--w);height:var(--h);cursor:pointer
}
.switch input{display:none}
.slider{
  background:linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
  border-radius:var(--h);height:100%;transition:.4s;
  border:2px solid var(--border);
  position:relative;
}
.slider::before{
  content:"";position:absolute;top:2px;left:2px;width:22px;height:22px;border-radius:50%;
  background:var(--brand-gradient);
  transition:.4s;
  box-shadow:0 0 10px rgba(139, 92, 246, 0.5);
}
.slider svg{position:absolute;top:50%;transform:translateY(-50%);pointer-events:none;transition:.3s}
.sun{left:8px;fill:#fbbf24;opacity:.4}
.moon{right:8px;fill:#e0e7ff;opacity:1}
input:checked + .slider{background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)}
input:checked + .slider::before{transform:translateX(26px);background:linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)}
input:checked + .slider .sun{opacity:1}
input:checked + .slider .moon{opacity:.4}

/* ---------- nav ---------- */
nav{
  position:sticky;top:0;z-index:150;
  background:var(--glass);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  display:flex;
  border-bottom:1px solid var(--border);
  padding:.5rem;
  gap:.5rem;
}
nav button{
  flex:1;padding:.85rem .5rem;
  background:transparent;
  border:1px solid transparent;
  border-radius:calc(var(--radius) - .25rem);
  font-weight:600;
  font-size:.9rem;
  color:var(--text-sub);
  cursor:pointer;
  transition:all .3s ease;
  position:relative;
  overflow:hidden;
}
nav button::before{
  content:'';position:absolute;inset:0;
  background:var(--brand-gradient);
  opacity:0;transition:.3s;
  z-index:-1;
}
nav button:hover{
  color:var(--text);
  border-color:var(--border);
  background:var(--glass);
}
nav button.active{
  color:#fff;
  border-color:transparent;
  background:var(--brand-gradient);
  box-shadow:var(--glow);
}

main{flex:1;padding:2rem 1.5rem;display:flex;justify-content:center}
.view{display:none;width:100%;max-width:900px;margin:auto;animation:fadeIn .4s ease}
.view.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* Buttons */
.btn{
  border-radius:var(--radius);font-weight:600;font-size:.95rem;padding:.75rem 1.5rem;
  display:inline-flex;align-items:center;justify-content:center;gap:.5rem;
  transition:all .3s ease;cursor:pointer;border:1px solid transparent;
  position:relative;overflow:hidden;
}
.btn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
  opacity:0;transition:.3s;
}
.btn:hover::before{opacity:1}

.fill{
  background:var(--brand-gradient);color:#fff;
  box-shadow:0 4px 15px rgba(139, 92, 246, 0.4);
}
.fill:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 25px rgba(139, 92, 246, 0.5);
}
.neutral{
  background:var(--glass);
  backdrop-filter:blur(10px);
  color:var(--text);
  border-color:var(--border);
}
.neutral:hover{
  background:var(--card-h);
  border-color:var(--brand);
}
.ghost{
  background:transparent;
  color:var(--brand);
  border:2px solid var(--brand);
}
.ghost:hover{
  background:var(--brand);
  color:#fff;
  box-shadow:var(--glow);
}

/* Flashcards */
.card-box{perspective:1200px;width:100%;max-width:550px;margin:auto}
.card{
  position:relative;width:100%;min-height:280px;
  border-radius:var(--radius);
  background:var(--glass);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  border:1px solid var(--border);
  transform-style:preserve-3d;transition:transform .7s cubic-bezier(0.4,0,0.2,1);
  display:flex;align-items:center;justify-content:center;
  padding:2rem;text-align:center;font-size:1.15rem;font-weight:500;
  box-shadow:var(--shadow);
  cursor:pointer;
}
.card::before{
  content:'';position:absolute;inset:-1px;
  border-radius:var(--radius);
  background:var(--brand-gradient);
  z-index:-1;opacity:.5;
  filter:blur(20px);
  transition:.3s;
}
.card:hover::before{opacity:.8;filter:blur(25px)}
.card.flipped{transform:rotateY(180deg)}
.side{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  padding:2rem;backface-visibility:hidden;
  border-radius:var(--radius);
}
.front{background:linear-gradient(145deg, rgba(139, 92, 246, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%)}
.back{transform:rotateY(180deg);background:linear-gradient(145deg, rgba(6, 182, 212, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%)}
.row{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;margin-top:1.5rem}

/* MCQ */
.block{
  margin-bottom:2.5rem;display:flex;flex-direction:column;gap:1rem;
  background:var(--glass);
  backdrop-filter:blur(15px);
  padding:1.5rem;
  border-radius:var(--radius);
  border:1px solid var(--border);
}
.block > p:first-child{
  font-size:1.1rem;
  font-weight:600;
  background:var(--brand-gradient);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}
.option{
  width:100%;padding:1.1rem 1.25rem;
  border-radius:calc(var(--radius) - .25rem);
  background:var(--glass);
  backdrop-filter:blur(10px);
  border:1px solid var(--border);
  color:var(--text);text-align:left;font:inherit;
  cursor:pointer;transition:all .25s ease;
  position:relative;
  overflow:hidden;
}
.option::before{
  content:'';position:absolute;left:0;top:0;bottom:0;width:3px;
  background:var(--brand-gradient);
  transform:scaleY(0);transition:.3s;
}
.option:hover:not(.disabled){
  background:var(--card-h);
  border-color:var(--brand);
  transform:translateX(5px);
}
.option:hover:not(.disabled)::before{transform:scaleY(1)}
.option.disabled{cursor:not-allowed;opacity:.7}
.correct{
  background:linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.1) 100%)!important;
  border-color:var(--green)!important;
  color:var(--green)!important;
}
.correct::before{background:var(--green)!important;transform:scaleY(1)!important}
.wrong{
  background:linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%)!important;
  border-color:var(--red)!important;
  color:var(--red)!important;
}
.wrong::before{background:var(--red)!important;transform:scaleY(1)!important}

/* textarea */
textarea{
  width:100%;min-height:160px;padding:1.25rem;
  background:var(--glass);
  backdrop-filter:blur(10px);
  border-radius:var(--radius);
  border:1px solid var(--border);
  resize:vertical;color:var(--text);
  font-family:'Inter',sans-serif;
  font-size:1rem;
  transition:all .3s ease;
}
textarea:focus{
  outline:none;
  border-color:var(--brand);
  box-shadow:0 0 0 3px rgba(139, 92, 246, 0.2);
}
textarea::placeholder{color:var(--text-sub)}

/* notes */
.notes{
  background:var(--glass);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  padding:2.5rem;
  border-radius:var(--radius);
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  line-height:1.7;
}

/* proper heading sizes inside rendered Markdown */
.notes h1{
  font-size:2.2rem;font-weight:800;margin:.2em 0 .8em;
  background:var(--brand-gradient);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}
.notes h2{
  font-size:1.7rem;font-weight:700;margin:1.2em 0 .6em;
  color:var(--brand);
}
.notes h3{font-size:1.35rem;font-weight:600;margin:1em 0 .5em;color:#06b6d4}
.notes h4{font-size:1.15rem;font-weight:600;margin:1em 0 .4em;color:#10b981}

/* list indentation & divider styling in notes */
.notes ul,.notes ol{margin-left:1.5rem;padding-left:.5rem}
.notes ul ul,.notes ol ol{margin-left:1.2rem}
.notes ul li{list-style:disc}
.notes ul ul li{list-style:circle}
.notes hr{border:0;height:1px;background:var(--brand-gradient);margin:2rem 0;opacity:.5}
.notes a{color:var(--brand);text-decoration:none;border-bottom:1px dashed var(--brand)}
.notes a:hover{border-bottom-style:solid}
.notes strong{color:var(--brand)}
.notes code:not(pre code){
  background:rgba(139, 92, 246, 0.15);
  padding:.2em .5em;
  border-radius:.3rem;
  font-family:'JetBrains Mono',monospace;
  font-size:.9em;
  color:#06b6d4;
}

/* collapsible animation */
.collapsible{
  max-height:0;overflow:hidden;
  transition:max-height var(--transition-speed) ease-out,opacity var(--transition-speed) ease-out,padding var(--transition-speed) ease-out;
  opacity:0;
  border-radius:0 0 var(--radius) var(--radius);
  background:var(--card-h);
  padding:0 1.25rem;
  border:1px solid var(--border);
  border-top:none;
  font-weight:500;
}
.collapsible.expanded{max-height:1000px;opacity:1;padding:1.25rem}
.accordion{margin-bottom:1rem}
.toggle-btn{
  display:flex;align-items:center;gap:.5rem;width:100%;text-align:left;
  font-weight:600;transition:all .3s;
  background:var(--glass);
  backdrop-filter:blur(10px);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:1rem 1.25rem;
}
.toggle-btn:hover{border-color:var(--brand)}
.toggle-btn.active{border-radius:var(--radius) var(--radius) 0 0;border-bottom:none;border-color:var(--brand)}
.toggle-btn::after{
  content:"‚ñº";transition:transform var(--transition-speed) ease;
  margin-left:auto;font-size:.75rem;color:var(--brand);
}
.toggle-btn.active::after{transform:rotate(180deg)}

/* floating selection btn */
#selAsk{
  position:fixed;
  z-index:2147483647;
  display:none;
  padding:.65rem 1.2rem;
  background:var(--brand-gradient);
  color:#fff;
  border:0;
  border-radius:var(--radius);
  font-weight:600;
  font-size:.95rem;
  box-shadow:var(--glow);
  align-items:center;
  justify-content:center;
  pointer-events:auto;
  cursor:pointer;
}

/* Quantum video button and player */
#parkourBtn{
  position:fixed;bottom:24px;right:24px;width:56px;height:56px;
  border-radius:50%;
  background:var(--brand-gradient);
  color:#fff;border:none;
  box-shadow:var(--glow);
  cursor:pointer;z-index:9998;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;transition:.4s;
  animation:pulse 2s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{box-shadow:0 0 20px rgba(139, 92, 246, 0.4), 0 0 40px rgba(6, 182, 212, 0.2)}
  50%{box-shadow:0 0 30px rgba(139, 92, 246, 0.6), 0 0 60px rgba(6, 182, 212, 0.3)}
}
#parkourBtn:hover{transform:scale(1.1) rotate(10deg)}
#videoContainer{
  position:fixed;bottom:24px;right:24px;width:300px;height:520px;
  background:var(--glass);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);z-index:9997;
  overflow:hidden;transform-origin:bottom right;
  transform:scale(0);opacity:0;
  transition:transform .4s cubic-bezier(0.4,0,0.2,1),opacity .3s;
  cursor:move;
}
#videoContainer.active{transform:scale(1);opacity:1}
#videoContainer iframe{width:100%;height:100%;border:none;aspect-ratio:9/16;object-fit:cover;pointer-events:none}
#closeVideo{
  position:absolute;top:12px;right:12px;width:38px;height:38px;
  border-radius:50%;
  background:var(--brand-gradient);
  color:#fff;border:none;
  cursor:pointer;z-index:9999;
  display:flex;align-items:center;justify-content:center;
  font-size:16px;box-shadow:var(--shadow);
  transition:transform .3s;
}
#closeVideo:hover{transform:scale(1.1) rotate(90deg)}
@media (max-width:768px){#videoContainer{width:160px;height:285px}}

/* Score display */
#mcqScore{
  background:var(--brand-gradient);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  font-size:1.3rem;
}

/* Scrollbar styling */
::-webkit-scrollbar{width:10px;height:10px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{
  background:var(--brand-gradient);
  border-radius:5px;
}
::-webkit-scrollbar-thumb:hover{background:var(--brand)}
</style>
</head>

<body>
<div class="particles" id="particles"></div>
<header>
  <h1>Quantum Computing Study Lab</h1>
  <label class="switch">
    <input type="checkbox" id="themeChk">
    <span class="slider">
      <svg class="sun" width="14" height="14" viewBox="0 0 24 24"><path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z"/><path d="M12 2v2m0 16v2m10-10h-2M4 12H2m3.64-6.36L5 5m12.36 12.36L19 19m0-14-1.36 1.36M5 19l1.36-1.36"/></svg>
      <svg class="moon" width="14" height="14" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79Z"/></svg>
    </span>
  </label>
</header>

<nav>
  <button data-view="flash" class="active">‚öõ Flashcards</button>
  <button data-view="mcq">üî¨ Quiz</button>
  <button data-view="written">üìù Written</button>
  <button data-view="tf">‚ö° True/False</button>
  <button data-view="notes">üìö Notes</button>
</nav>

<main>
  <!-- FLASHCARDS -->
  <section id="flash" class="view active">
    <div class="card-box">
      <div class="card" id="fcCard">
        <div class="side front" id="fcQ"></div>
        <div class="side back" id="fcA"></div>
      </div>
    </div>
    <div class="row"><button id="fcPrev" class="btn neutral">‚Üê Previous</button><button id="fcNext" class="btn fill">Next ‚Üí</button></div>
    <div class="row" style="margin-top:.5rem"><button id="fcAsk" class="btn ghost">‚ú® Ask ChatGPT</button></div>
  </section>

  <!-- MCQ -->
  <section id="mcq" class="view"><div id="mcqWrap"></div><p id="mcqScore" style="font-weight:700;text-align:center"></p></section>

  <!-- WRITTEN -->
  <section id="written" class="view">
    <div class="block">
      <p id="waQ" style="font-weight:600"></p>
      <textarea id="waInput" placeholder="Enter your answer here‚Ä¶"></textarea>

      <div class="accordion">
        <button id="waToggle" class="btn toggle-btn">üîì Reveal Correct Answer</button>
        <div id="waA" class="collapsible"></div>
      </div>

      <div class="row"><button id="waPrev" class="btn neutral">‚Üê Previous</button><button id="waNext" class="btn fill">Next ‚Üí</button></div>
      <div class="row" style="margin-top:.5rem"><button id="waAsk" class="btn ghost">‚ú® Ask ChatGPT</button></div>
    </div>
  </section>

  <!-- TRUE/FALSE -->
  <section id="tf" class="view">
    <div class="block">
      <p id="tfQ" style="font-weight:600"></p>
      <div class="row"><button class="btn option" data-val="true">‚úì True</button><button class="btn option" data-val="false">‚úó False</button></div>
      <div class="row"><button id="tfPrev" class="btn neutral">‚Üê Previous</button><button id="tfNext" class="btn fill">Next ‚Üí</button></div>
      <div class="row" style="margin-top:.5rem"><button id="tfAsk" class="btn ghost">‚ú® Ask ChatGPT</button></div>
    </div>
  </section>

  <!-- NOTES -->
  <section id="notes" class="view"><article id="notesBox" class="notes">Loading quantum data‚Ä¶</article></section>
</main>

<button id="selAsk">‚ú® Ask ChatGPT</button>
<button id="parkourBtn">‚öõ</button>
<div id="videoContainer">
  <button id="closeVideo">‚úñ</button>
  <iframe id="parkourVideo" src="" frameborder="0" allowfullscreen></iframe>
</div>

<!-- ----------------------- APP ----------------------- -->
<script>
/* ---------- floating particles ---------- */
(function(){
  const container = document.getElementById('particles');
  for(let i=0; i<30; i++){
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = Math.random()*100+'%';
    p.style.animationDelay = Math.random()*15+'s';
    p.style.animationDuration = (10+Math.random()*10)+'s';
    const colors = ['#8b5cf6','#06b6d4','#10b981','#ec4899'];
    p.style.background = colors[Math.floor(Math.random()*colors.length)];
    p.style.boxShadow = '0 0 6px '+p.style.background;
    container.appendChild(p);
  }
})();

/* ---------- markdown‚Äëit + highlight helper ---------- */
const md = window.markdownit({
  html: true,
  linkify: true,
  typographer: true,
  breaks: true
});
function renderMD(el, src){
  el.innerHTML = md.render(src);
  if (window.MathJax){
    if (typeof MathJax.typesetPromise === 'function') MathJax.typesetPromise();
    else if (typeof MathJax.typeset === 'function') MathJax.typeset();
  }
  if (window.hljs) hljs.highlightAll();
}

const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}};
const ask=p=>window.open('https://chatgpt.com/?model=gpt-4o&temporary-chat=true&q='+encodeURIComponent(p),'_blank');
const dataPromise=fetch('data.json').then(r=>r.json());

/* ---------- theme persistence ---------- */
const chk=$('#themeChk');
const applyTheme=mode=>{document.documentElement.classList.toggle('light',mode==='light');chk.checked=mode==='light';localStorage.theme=mode};
applyTheme(localStorage.theme||'dark');
chk.onchange=()=>applyTheme(chk.checked?'light':'dark');

/* ---------- nav switching + clear selection ---------- */
$$('nav button').forEach(btn=>btn.onclick=()=>{$('nav .active').classList.remove('active');btn.classList.add('active');$('.view.active').classList.remove('active');$('#'+btn.dataset.view).classList.add('active');getSelection().removeAllRanges();$('#selAsk').style.display='none';});

/* ‚Äî‚Äî‚Äî SWIPE SUPPORT ‚Äî‚Äî‚Äî */
function addSwipe(el,onLeft,onRight){
  let sx=0,sy=0;const thresh=50,restraint=100;
  el.addEventListener('touchstart',e=>{
    const t=e.changedTouches[0];sx=t.pageX;sy=t.pageY;
  },{passive:true});
  el.addEventListener('touchend',e=>{
    const t=e.changedTouches[0];
    const dx=t.pageX-sx,dy=t.pageY-sy;
    if(Math.abs(dx)>=thresh&&Math.abs(dy)<=restraint){
      dx<0?onLeft&&onLeft():onRight&&onRight();
    }
  },{passive:true});
}

/* ---------- FLASHCARDS ---------- */
(async()=>{
 const arr=(await dataPromise).flashcards;shuffle(arr);let i=0;
 const card=$('#fcCard'),q=$('#fcQ'),a=$('#fcA');
 const render=()=>{
   const c=arr[i];
   renderMD(q, c.q);
   renderMD(a, c.a);
   card.classList.remove('flipped');
 };
 render();
 card.onclick=()=>card.classList.toggle('flipped');
 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#fcPrev').onclick=prev;
 $('#fcNext').onclick=next;
 addSwipe($('#flash'),next,prev);
 $('#fcAsk').onclick=()=>ask(`Explain the following quantum computing concept in simple terms:\n"${arr[i].q}"`);
})();

/* ---------- MCQ ---------- */
(async()=>{
 const arr=(await dataPromise).multipleChoice;shuffle(arr);
 const wrap=$('#mcqWrap'),score=$('#mcqScore');let sc=0;
 arr.forEach((q,idx)=>{
  shuffle(q.choices);
  const blk=document.createElement('div');blk.className='block';blk.innerHTML=`<p>Question ${idx+1}: ${q.question}</p>`;
  const optWrap=document.createElement('div');optWrap.style.display='grid';optWrap.style.gap='.75rem';
  const opts=[];
  q.choices.forEach(c=>{
    const btn=document.createElement('button');btn.className='btn option';btn.textContent=c;
    btn.onclick=()=>{
      opts.forEach(o=>{o.disabled=true;o.classList.add('disabled')});
      btn.classList.add(c===q.answer?'correct':'wrong');
      if(c===q.answer)sc++;else opts.find(o=>o.textContent===q.answer).classList.add('correct');
      score.textContent=`‚öõ Score: ${sc}/${arr.length}`;
    };
    opts.push(btn);optWrap.appendChild(btn);
  });
  const askBtn=document.createElement('button');askBtn.className='btn ghost';askBtn.textContent='‚ú® Ask ChatGPT';
  askBtn.onclick=()=>ask(`Quantum computing multiple-choice question:\n${q.question}\nOptions: ${q.choices.join(', ')}\nExplain why the correct answer ("${q.answer}") is right and others are wrong.`);
  blk.append(optWrap,askBtn);wrap.appendChild(blk);
 });
})();

/* ---------- WRITTEN ---------- */
(async()=>{
 const arr=(await dataPromise).writtenAnswer;shuffle(arr);let i=0;
 const q=$('#waQ'),aBox=$('#waA'),tBtn=$('#waToggle');

 const render=()=>{
   renderMD(q, arr[i].q);
   aBox.innerHTML='';
   aBox.classList.remove('expanded');
   tBtn.classList.remove('active');
   tBtn.textContent='üîì Reveal Correct Answer';
 };
 render();

 tBtn.onclick=()=>{
   const expanded=aBox.classList.contains('expanded');
   if(!expanded) renderMD(aBox, arr[i].a);
   aBox.classList.toggle('expanded');
   tBtn.classList.toggle('active');
 };

 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#waPrev').onclick=prev;
 $('#waNext').onclick=next;
 addSwipe($('#written'),next,prev);
 $('#waAsk').onclick=()=>ask(`I'm studying quantum computing. Could you explain the following question for me?\n"${arr[i].q}"\n\nThe correct answer is: "${arr[i].a}"`);
})();

/* ---------- TRUE/FALSE ---------- */
(async()=>{
 const arr=(await dataPromise).trueFalse;shuffle(arr);let i=0;
 const q=$('#tfQ'),btns=$$('#tf button.option');
 const render=()=>{
   renderMD(q, arr[i].q);
   btns.forEach(b=>{b.disabled=false;b.classList.remove('correct','wrong','disabled')});
 };
 btns.forEach(b=>b.onclick=()=>{
  const ans=b.dataset.val==='true',ok=arr[i].a;
  btns.forEach(x=>{x.disabled=true;x.classList.add('disabled')});
  b.classList.add(ans===ok?'correct':'wrong');
 });
 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#tfPrev').onclick=prev;
 $('#tfNext').onclick=next;
 addSwipe($('#tf'),next,prev);
 $('#tfAsk').onclick=()=>ask(`Is the following statement about quantum computing true or false? Explain.\n"${arr[i].q}"\n\nThe correct answer is: ${arr[i].a ? "True" : "False"}`);
 render();
})();

/* ---------- NOTES + floating ask ---------- */
(async()=>{
  const box = $('#notesBox');
  renderMD(box, await (await fetch('notes.md')).text());
  const float = $('#selAsk');
  float.style.display = 'none';
  const isMobile = window.matchMedia('(pointer: coarse)').matches;
  let currentSelText = '';

  const updateFloatPosition = () => {
    const sel = getSelection();
    if (!sel || sel.isCollapsed || !$('#notesBox').contains(sel.anchorNode)) {
      float.style.display = 'none';
      currentSelText = '';
      return;
    }
    currentSelText = sel.toString().trim();
    const r = sel.getRangeAt(0).getBoundingClientRect();
    float.style.position = 'fixed';
    const extra = isMobile ? 36 : 20;
    float.style.top = `${r.bottom + extra}px`;
    float.style.left = `${r.left}px`;
    float.style.display = 'flex';
    const fr = float.getBoundingClientRect();
    const vw = document.documentElement.clientWidth;
    if (fr.right > vw) float.style.left = `${vw - fr.width - 10}px`;
  };

  const askSelection = () => {
    if (currentSelText)
      ask(`Explain this excerpt from my quantum computing notes:\n"${currentSelText}"`);
  };

  float.addEventListener('click', e => { e.preventDefault(); askSelection(); });
  if (isMobile) {
    float.addEventListener('touchend', e => { e.preventDefault(); askSelection(); });
  } else {
    float.addEventListener('mousedown', e => { e.preventDefault(); askSelection(); });
  }

  document.addEventListener('selectionchange', updateFloatPosition);
  document.addEventListener('touchend', () => setTimeout(updateFloatPosition, 100));
  document.addEventListener('scroll', () => {
    if (getSelection() && !getSelection().isCollapsed) updateFloatPosition();
  });
  window.addEventListener('resize', () => {
    if (getSelection() && !getSelection().isCollapsed) updateFloatPosition();
  });
})();

/* ---------- QUANTUM VIDEO ---------- */
const parkourBtn=document.getElementById('parkourBtn');
const videoContainer=document.getElementById('videoContainer');
const closeVideo=document.getElementById('closeVideo');
const parkourVideo=document.getElementById('parkourVideo');
let isDragging=false,initialX,initialY,currentX=0,currentY=0;
videoContainer.addEventListener('mousedown',startDrag);
videoContainer.addEventListener('touchstart',startDrag,{passive:false});
document.addEventListener('mousemove',drag);
document.addEventListener('touchmove',drag,{passive:false});
document.addEventListener('mouseup',stopDrag);
document.addEventListener('touchend',stopDrag);
function startDrag(e){
  if(e.type==='touchstart')e.preventDefault();
  if(e.target===closeVideo)return;
  isDragging=true;
  const r=videoContainer.getBoundingClientRect();
  if(e.type==='touchstart'){initialX=e.touches[0].clientX-r.left;initialY=e.touches[0].clientY-r.top;}
  else{initialX=e.clientX-r.left;initialY=e.clientY-r.top;}
  videoContainer.classList.add('dragging');
}
function drag(e){
  if(!isDragging)return;
  e.preventDefault();
  if(e.type==='touchmove'){currentX=e.touches[0].clientX-initialX;currentY=e.touches[0].clientY-initialY;}
  else{currentX=e.clientX-initialX;currentY=e.clientY-initialY;}
  const r=videoContainer.getBoundingClientRect(),vw=window.innerWidth,vh=window.innerHeight;
  if(currentX<0)currentX=0;
  if(currentX+r.width>vw)currentX=vw-r.width;
  if(currentY<0)currentY=0;
  if(currentY+r.height>vh)currentY=vh-r.height;
  videoContainer.style.right='auto';videoContainer.style.bottom='auto';
  videoContainer.style.left=currentX+'px';videoContainer.style.top=currentY+'px';
}
function stopDrag(){if(!isDragging)return;isDragging=false;videoContainer.classList.remove('dragging');}
const parkourVideos=[
  'https://www.youtube.com/embed/7yl7Wc1dtWc?autoplay=1&mute=1&loop=1&playlist=7yl7Wc1dtWc&controls=0&showinfo=0&rel=0&modestbranding=1&iv_load_policy=3&disablekb=1',
  'https://www.youtube.com/embed/tCBOhczn6Ok?autoplay=1&mute=1&loop=1&playlist=tCBOhczn6Ok&controls=0&showinfo=0&rel=0&modestbranding=1&iv_load_policy=3&disablekb=1'
];
parkourBtn.addEventListener('click',()=>{
  const url=parkourVideos[Math.floor(Math.random()*parkourVideos.length)];
  parkourVideo.src=url;
  parkourBtn.style.opacity='0';
  setTimeout(()=>{parkourBtn.style.display='none';videoContainer.style.right='24px';videoContainer.style.bottom='24px';videoContainer.style.left='auto';videoContainer.style.top='auto';videoContainer.style.display='block';setTimeout(()=>videoContainer.classList.add('active'),10);},300);
});
function hideVideo(){
  videoContainer.classList.remove('active');
  setTimeout(()=>{videoContainer.style.display='none';parkourVideo.src='';parkourBtn.style.display='flex';setTimeout(()=>parkourBtn.style.opacity='1',10);},300);
}
closeVideo.addEventListener('click',hideVideo);
closeVideo.addEventListener('touchstart',e=>e.stopPropagation());
closeVideo.addEventListener('touchend',e=>{e.preventDefault();e.stopPropagation();hideVideo();});
</script>
</body>
</html>
