<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Biologically-Inspired Algorithms &amp; Models Study App</title>
  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root {
      --brand: #4a90e2;
      --bg: #f0f4f8;
      --card: #fff;
      --txt: #333;
      --border: #ccc;
      --radius: 8px;
      --shadow: rgba(0,0,0,0.1);
      --font: 1rem;
    }
    body.dark {
      --bg: #121212;
      --card: #1e1e1e;
      --txt: #eee;
      --border: #555;
    }
    body.notes-mode main {
      max-width: none;
      width: 100%;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      font-size: var(--font);
      background: var(--bg);
      color: var(--txt);
      display: flex; flex-direction: column; min-height: 100vh;
      transition: background .3s, color .3s;
    }
    header {
      display: flex; align-items: center; justify-content: space-between;
      background: var(--brand); color: #fff; padding: 1rem;
      box-shadow: 0 2px 4px var(--shadow);
    }
    header h1 { font-size:1.25rem; }
    #dark-toggle {
      background: transparent; border: none; font-size: 1.2rem;
      cursor: pointer; color: #fff;
    }
    nav {
      display: flex; background: var(--card);
      box-shadow: 0 2px 4px var(--shadow); overflow-x: auto;
    }
    nav button {
      flex: 1 0 auto; padding: 0.75rem; border: none;
      background: var(--card); color: var(--txt);
      font-size: 1rem; cursor: pointer; transition: background .3s;
    }
    nav button.active,
    nav button:hover {
      background: var(--brand); color: #fff;
    }
    main {
      flex: 1; padding: 2rem; max-width: 800px; margin: auto; width: 100%;
      transition: max-width .3s;
    }
    .mode-section { display: none; }
    .mode-section.active { display: block; }

    /* Flashcards */
    .flashcard-container { perspective: 1200px; text-align: center; }
    .card {
      width: 90%; max-width: 360px; height: 220px; margin: auto; cursor: pointer;
      transform-style: preserve-3d; transition: transform .6s;
      border-radius: var(--radius); box-shadow: 0 4px 8px var(--shadow);
      position: relative;
    }
    .card.flipped { transform: rotateY(180deg); }
    .card-face {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden; background: var(--card);
      border-radius: var(--radius); display: flex;
      align-items: center; justify-content: center;
      padding: 1rem; text-align: center; font-size: 1.1rem;
    }
    .card-face.back { transform: rotateY(180deg); }
    .fc-nav{
      display:flex;
      gap:1rem;
      width:100%;
    }
    .fc-controls {
      margin-top: 1rem; display: flex; gap: 1rem; justify-content: center;
    }
    .fc-controls button {
      padding: .5rem 1rem; border: none; border-radius: var(--radius);
      background: var(--brand); color: #fff; cursor: pointer;
      transition: background .3s;
      flex: 1;
    }
    #ask-fc {
      background: transparent; border: 1px solid #fff; color: #fff;
    }
    .ask-btn.standalone{
      width:100%;
      margin-top:1rem;
    }

    /* Quiz & True/False */
    .quiz-item, .tf-container button {
      margin-bottom: 1rem; padding: 1rem;
      background: var(--card); border-radius: var(--radius);
      box-shadow: 0 2px 4px var(--shadow); transition: transform .2s;
    }
    .quiz-item:hover, .tf-container button:hover {
      transform: translateY(-2px);
    }
    .quiz-item p { margin-bottom: .75rem; font-weight: bold; }
    .quiz-item button, .tf-container button {
      width: 100%; margin: .25rem 0; padding: .75rem;
      border: 1px solid var(--border); border-radius: var(--radius);
      background: var(--card); color: var(--txt);
      cursor: pointer; transition: background .3s, border-color .3s;
      text-align: center; font-size: 1rem;
    }
    .quiz-item button.correct {
      border-color: #4caf50; background: #2e4a2e; color: #fff;
    }
    .quiz-item button.wrong {
      border-color: #f44336; background: #4a1e1e; color: #fff;
    }
    .ask-btn {
      margin-top: .5rem; background: var(--brand); color: #fff;
      border: none; padding: .5rem; border-radius: var(--radius);
    }
    #selection-ask{
      padding:.35rem .75rem;
      font-size:.9rem;
      background:var(--brand);
      color:#fff;
      border:none;
      border-radius:var(--radius);
      cursor:pointer;
      position:absolute;
      display:none;
      z-index:999;
    }
    #quiz-score { text-align: center; font-weight: bold; margin-top: 1rem; }

    /* Written Answer */
    .wa-container, .tf-container {
      display: flex; flex-direction: column; gap: 1rem; align-items: center;
    }
    .wa-container textarea {
      width: 100%; min-height: 80px; padding: .75rem;
      border: 1px solid var(--border); border-radius: var(--radius);
      font-size: 1rem; resize: vertical;
      background: var(--card); color: var(--txt);
    }
    .wa-container button {
      padding: .5rem 1.5rem; border: none; border-radius: var(--radius);
      background: var(--brand); color: #fff; cursor: pointer;
    }
    .feedback { font-weight: bold; font-size: 1.1rem; }
    .next-btn { background: #333; color: #fff; }

    /* Notes */
    #notes-container {
      background: var(--card); padding: 2rem;
      border-radius: var(--radius); box-shadow: 0 2px 4px var(--shadow);
      line-height: 1.6;
    }

    /* Mobile tweaks */
    @media (max-width: 600px) {
      body { font-size: .95rem; }
      main { padding: 1rem; }
      nav button { font-size: .85rem; padding: .6rem; }
    }
  </style>
</head>
<body>

  <header>
    <h1>Biologically-Inspired Algorithms &amp; Models</h1>
    <button id="dark-toggle" aria-label="Toggle Dark Mode">🌙</button>
  </header>

  <nav>
    <button data-mode="flash" class="active">Flashcards</button>
    <button data-mode="mcq">Multiple Choice</button>
    <button data-mode="written">Written Answer</button>
    <button data-mode="truefalse">True / False</button>
    <button data-mode="notes">Notes</button>
  </nav>

  <main>
    <!-- Flashcards -->
    <section id="flash" class="mode-section active">
      <div class="flashcard-container">
        <div id="card" class="card">
          <div class="card-face front" id="fc-q"></div>
          <div class="card-face back" id="fc-a"></div>
        </div>
        <div class="fc-nav">
          <button id="prev-fc">Previous</button>
          <button id="next-fc">Next</button>
        </div>
        <button id="ask-fc" class="ask-btn standalone">Ask ChatGPT</button>
      </div>
    </section>

    <!-- Multiple Choice -->
    <section id="mcq" class="mode-section">
      <div id="mcq-container"></div>
      <div id="quiz-score"></div>
    </section>

    <!-- Written Answer -->
    <section id="written" class="mode-section">
      <div class="wa-container">
        <p id="wa-q"></p>
        <textarea id="wa-input" placeholder="Type your answer..."></textarea>
        <button id="wa-check">Show Answer</button>
        <div id="wa-feedback" class="feedback"></div>
        <button id="wa-ask" class="ask-btn">Ask ChatGPT</button>
        <button id="wa-next" class="next-btn">Next Question</button>
      </div>
    </section>

    <!-- True / False -->
    <section id="truefalse" class="mode-section">
      <div class="tf-container">
        <p id="tf-q"></p>
        <button data-val="true">True</button>
        <button data-val="false">False</button>
        <div id="tf-feedback" class="feedback"></div>
        <button id="tf-ask" class="ask-btn">Ask ChatGPT</button>
        <button id="tf-next" class="next-btn">Next Question</button>
      </div>
    </section>

    <!-- Notes -->
    <section id="notes" class="mode-section">
      <div id="notes-container">Loading notes…</div>
    </section>
  </main>

  <button id="selection-ask" class="ask-btn" style="position:absolute;display:none;z-index:999;"></button>

  <script>
  (async () => {
    const json = await fetch('data.json').then(r => r.json());
    // shuffle helper
    const shuffle = a => {
      for (let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
    };
    shuffle(json.flashcards);
    json.multipleChoice.forEach(q=>shuffle(q.choices));
    shuffle(json.multipleChoice);
    shuffle(json.writtenAnswer);
    shuffle(json.trueFalse);

    // build ChatGPT link
    const buildLink = prompt =>
      'https://chatgpt.com/?model=gpt-4o&temporary-chat=true&q=' +
      encodeURIComponent(prompt);

    // dark mode
    const dt = document.getElementById('dark-toggle');
    if (localStorage.getItem('darkMode')==='enabled'){
      document.body.classList.add('dark'); dt.textContent='☀️';
    }
    dt.onclick = () => {
      const on = document.body.classList.toggle('dark');
      dt.textContent = on?'☀️':'🌙';
      localStorage.setItem('darkMode', on?'enabled':'disabled');
    };

    // nav
    document.querySelectorAll('nav button').forEach(btn=>{
      btn.onclick=()=>{
        document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.mode-section').forEach(s=>s.classList.remove('active'));
        document.getElementById(btn.dataset.mode).classList.add('active');
        document.body.classList.toggle('notes-mode', btn.dataset.mode==='notes');
      };
    });

    // FLASHCARDS
    let fc=0;
    const fcQ=document.getElementById('fc-q'),
          fcA=document.getElementById('fc-a'),
          card=document.getElementById('card'),
          askFc=document.getElementById('ask-fc');
    const showFC=i=>{
      const c=json.flashcards[i];
      fcQ.textContent=c.q;
      fcA.textContent=c.a;
      card.classList.remove('flipped');
      askFc.onclick=()=>{
        const prompt=`Explain this flashcard:\nQuestion: ${c.q}\nAnswer: ${c.a}`;
        window.open(buildLink(prompt),'_blank');
      };
    };
    document.getElementById('next-fc').onclick=()=>showFC(fc=(fc+1)%json.flashcards.length);
    document.getElementById('prev-fc').onclick=()=>showFC(fc=(fc-1+json.flashcards.length)%json.flashcards.length);
    card.onclick=()=>card.classList.toggle('flipped');
    showFC(fc);

    // MCQ
    const mcqCt=document.getElementById('mcq-container'),
          scoreEl=document.getElementById('quiz-score');
    const buildMC=()=>{
      let score=0;
      mcqCt.innerHTML='';
      json.multipleChoice.forEach((q,i)=>{
        const box=document.createElement('div');
        box.className='quiz-item';
        box.innerHTML=`<p>${i+1}. ${q.question}</p>`;
        q.choices.forEach(ch=>{
          const btn=document.createElement('button');
          btn.textContent=ch;
          btn.onclick=()=>{
            if(ch===q.answer){
              btn.classList.add('correct'); score++;
            } else {
              btn.classList.add('wrong');
              box.querySelectorAll('button').forEach(b=>{
                if(b.textContent===q.answer) b.classList.add('correct');
              });
            }
            box.querySelectorAll('button').forEach(b=>{
              if(!b.classList.contains('ask-btn')) b.disabled=true;
            });
            scoreEl.textContent=`Score: ${score} / ${json.multipleChoice.length}`;
          };
          box.appendChild(btn);
        });
        const askBtn=document.createElement('button');
        askBtn.textContent='Ask ChatGPT';
        askBtn.className='ask-btn';
        askBtn.onclick=()=>{
          const prompt=`Explain this multiple-choice question:\nQuestion: ${q.question}\nChoices: ${q.choices.join(', ')}\nAnswer: ${q.answer}`;
          window.open(buildLink(prompt),'_blank');
        };
        box.appendChild(askBtn);
        mcqCt.appendChild(box);
      });
      scoreEl.textContent=`Score: 0 / ${json.multipleChoice.length}`;
    };
    buildMC();

    // WRITTEN
    let wa=0;
    const waQ=document.getElementById('wa-q'),
          waIn=document.getElementById('wa-input'),
          waFb=document.getElementById('wa-feedback'),
          waChk=document.getElementById('wa-check'),
          waAsk=document.getElementById('wa-ask'),
          waNx=document.getElementById('wa-next');
    const showWA=i=>{
      const q=json.writtenAnswer[i];
      wa=i; waQ.textContent=q.q;
      waIn.value=''; waFb.textContent=''; waNx.style.display='none';
      waAsk.onclick=()=>{
        window.open(buildLink(`Explain this question:\nQuestion: ${q.q}\nAnswer: ${q.a}`),'_blank');
      };
    };
    waChk.onclick=()=>{
      waFb.textContent=`Answer: ${json.writtenAnswer[wa].a}`;
      waNx.style.display='inline-block';
    };
    waNx.onclick=()=>showWA((wa+1)%json.writtenAnswer.length);
    showWA(0);

    // TRUE/FALSE
    let tf=0;
    const tfQ=document.getElementById('tf-q'),
          tfFb=document.getElementById('tf-feedback'),
          tfBtns=document.querySelectorAll('#truefalse button[data-val]'),
          tfAsk=document.getElementById('tf-ask'),
          tfNx=document.getElementById('tf-next');
    const showTF=i=>{
      const q=json.trueFalse[i];
      tf=i; tfQ.textContent=q.q; tfFb.textContent='';
      tfBtns.forEach(b=>{ b.disabled=false; b.classList.remove('correct','wrong'); });
      tfAsk.onclick=()=>{
        window.open(buildLink(`Explain this true/false question:\nQuestion: ${q.q}\nAnswer: ${q.a?'True':'False'}`),'_blank');
      };
      tfNx.style.display='none';
    };
    tfBtns.forEach(b=>{
      b.onclick=()=>{
        const val=b.dataset.val==='true',
              ok=json.trueFalse[tf].a;
        if(val===ok){
          b.classList.add('correct');
          tfFb.textContent='✅ Correct!';
          tfFb.className='feedback correct';
        } else {
          b.classList.add('wrong');
          tfFb.textContent=`❌ Wrong. Answer: ${ok?'True':'False'}`;
          tfFb.className='feedback wrong';
        }
        tfBtns.forEach(x=>x.disabled=true);
        tfNx.style.display='inline-block';
      };
    });
    tfNx.onclick=()=>showTF((tf+1)%json.trueFalse.length);
    showTF(0);

    // NOTES
    fetch('notes.md')
      .then(r=>r.text())
      .then(md=>document.getElementById('notes-container').innerHTML=marked.parse(md));

    /* ====== ask ChatGPT for selected text in notes ====== */
    const selBtn=document.getElementById('selection-ask');
    const notesEl=document.getElementById('notes-container');
    document.addEventListener('mousedown',()=>selBtn.style.display='none');
    notesEl.addEventListener('mouseup',e=>{
      const sel=window.getSelection();
      const text=sel.toString().trim();
      if(!text) return;
      const rect=sel.getRangeAt(0).getBoundingClientRect();
      selBtn.style.top=`${rect.bottom+window.scrollY+5}px`;
      selBtn.style.left=`${rect.left+window.scrollX}px`;
      selBtn.style.display='block';
      selBtn.textContent='Ask ChatGPT';
      selBtn.onclick=()=>{
        window.open(buildLink(`Explain the following note:\n${text}`),'_blank');
        selBtn.style.display='none';
      };
    });
  })();
  </script>
</body>
</html>