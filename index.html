<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Process Mining Study Suite</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">

<!-- â”€â”€ Markdown-it + highlight.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/lib/common.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>

<!-- Add MathJax for LaTeX rendering -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>

<!-- -----------------  DESIGN TOKENS  ----------------- -->
<style>
:root{
  /* light */
  --brand:#f97316;      --brand-h:#ea580c;
  --bg:#f9fafb;         --bg-h:#eff1f5;
  --card:#ffffff;       --card-h:#e5e7eb;
  --text:#0f172a;       --text-sub:#475569;
  --border:#d1d5db;
  --green:#16a34a;      --red:#dc2626;
  --radius:.75rem;      --shadow:0 4px 14px rgb(0 0 0/.06);
  --transition-speed: 0.3s;
}
/* dark */
html.dark{
  --bg:#0f172a;  --bg-h:#1e293b;
  --card:#1e293b;--card-h:#334155;
  --text:#f1f5f9;--text-sub:#94a3b8;
  --border:#475569;--shadow:0 4px 18px rgb(0 0 0/.55);
}
*{box-sizing:border-box;margin:0;padding:0} html,body{height:100%}
body{
  font:400 1rem/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);color:var(--text);display:flex;flex-direction:column;
  -webkit-font-smoothing:antialiased;
}

/* code blocks */
pre code{
  display:block;
  overflow-x:auto;
  padding:1rem;
  border-radius:var(--radius);
  background:var(--card-h);
}

/* ---------- header & theme switch ---------- */
header{padding:1rem 1.2rem;background:var(--brand);display:flex;justify-content:space-between;align-items:center;color:#fff;box-shadow:var(--shadow);z-index:200}
header h1{font-size:1.15rem;font-weight:600}
.switch{
  --w:52px;--h:28px;position:relative;display:inline-block;width:var(--w);height:var(--h);cursor:pointer
}
/* ...   (unchanged CSS omitted for brevity)   ... */
/* keep the remainder of your original styles here */
</style>
</head>

<body>
<header>
  <h1>Process Mining Study Suite</h1>
  <label class="switch">
    <input type="checkbox" id="themeChk">
    <span class="slider">
      <svg class="sun"  width="14" height="14" viewBox="0 0 24 24"><path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z"/><path d="M12 2v2m0 16v2m10-10h-2M4 12H2m3.64-6.36L5 5m12.36 12.36L19 19m0-14-1.36 1.36M5 19l1.36-1.36"/></svg>
      <svg class="moon" width="14" height="14" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79Z"/></svg>
    </span>
  </label>
</header>

<nav>
  <button data-view="flash"  class="active">Flashcards</button>
  <button data-view="mcq">Multiple-Choice</button>
  <button data-view="written">Written</button>
  <button data-view="tf">True/False</button>
  <button data-view="notes">Notes</button>
</nav>

<main>
  <!-- FLASHCARDS -->
  <section id="flash" class="view active">
    <div class="card-box">
      <div class="card" id="fcCard">
        <div class="side front" id="fcQ"></div>
        <div class="side back"  id="fcA"></div>
      </div>
    </div>
    <div class="row"><button id="fcPrev" class="btn neutral">Prev</button><button id="fcNext" class="btn fill">Next</button></div>
    <div class="row" style="margin-top:.5rem"><button id="fcAsk" class="btn ghost">Ask ChatGPT</button></div>
  </section>

  <!-- MCQ -->
  <section id="mcq" class="view"><div id="mcqWrap"></div><p id="mcqScore" style="font-weight:700;text-align:center"></p></section>

  <!-- WRITTEN -->
  <section id="written" class="view">
    <div class="block">
      <p id="waQ" style="font-weight:600"></p>
      <textarea id="waInput" placeholder="Your answerâ€¦"></textarea>

      <div class="accordion">
        <button id="waToggle" class="btn toggle-btn">Correct answer</button>
        <div id="waA" class="collapsible"></div>
      </div>

      <div class="row"><button id="waPrev" class="btn neutral">Prev</button><button id="waNext" class="btn fill">Next</button></div>
      <div class="row" style="margin-top:.5rem"><button id="waAsk" class="btn ghost">Ask ChatGPT</button></div>
    </div>
  </section>

  <!-- TRUE/FALSE -->
  <section id="tf" class="view">
    <div class="block">
      <p id="tfQ" style="font-weight:600"></p>
      <div class="row"><button class="btn option" data-val="true">True</button><button class="btn option" data-val="false">False</button></div>
      <div class="row"><button id="tfPrev" class="btn neutral">Prev</button><button id="tfNext" class="btn fill">Next</button></div>
      <div class="row" style="margin-top:.5rem"><button id="tfAsk" class="btn ghost">Ask ChatGPT</button></div>
    </div>
  </section>

  <!-- NOTES -->
  <section id="notes" class="view"><article id="notesBox" class="notes">Loadingâ€¦</article></section>
</main>

<button id="selAsk">Ask ChatGPT</button>
<button id="parkourBtn">ðŸ§ </button>
<div id="videoContainer">
  <button id="closeVideo">âœ–</button>
  <iframe id="parkourVideo" src="" frameborder="0" allowfullscreen></iframe>
</div>

<!-- ----------------------- APP ----------------------- -->
<script>
/* ---------- markdown-it instance ---------- */
const md = window.markdownit({
  html:true,
  linkify:true,
  typographer:true,
  breaks:true,
  highlight: (str, lang) => {
    if (lang && window.hljs.getLanguage(lang)) {
      try {
        return '<pre class="hljs"><code>' +
          window.hljs.highlight(str, {language: lang, ignoreIllegals:true}).value +
          '</code></pre>';
      } catch(_) {}
    }
    return '<pre class="hljs"><code>' + md.utils.escapeHtml(str) + '</code></pre>';
  }
});

const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}};
const ask=p=>window.open('https://chatgpt.com/?model=gpt-4o&temporary-chat=true&q='+encodeURIComponent(p),'_blank');
const dataPromise=fetch('data.json').then(r=>r.json());

/* ---------- theme persistence ---------- */
/* ... original JS continues, replacing every marked.parse(...) with the block below ... */

function renderMD(target, source){
  target.innerHTML = md.render(source);
  if (window.MathJax) MathJax.typesetPromise();
  if (window.hljs) window.hljs.highlightAll();
}

/* FLASHCARDS */
(async()=>{
 const arr=(await dataPromise).flashcards;shuffle(arr);let i=0;
 const card=$('#fcCard'),q=$('#fcQ'),a=$('#fcA');
 const render=()=>{
   const c=arr[i];
   renderMD(q, c.q);
   renderMD(a, c.a);
   card.classList.remove('flipped');
 };
 render();
 card.onclick=()=>card.classList.toggle('flipped');
 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#fcPrev').onclick=prev;
 $('#fcNext').onclick=next;
 addSwipe($('#flash'),next,prev);
 $('#fcAsk').onclick=()=>ask(`Explain the following concept from process mining in simple terms:\n"${arr[i].q}"`);
})();

/* MCQ */
(async()=>{
 const arr=(await dataPromise).multipleChoice;shuffle(arr);
 const wrap=$('#mcqWrap'),score=$('#mcqScore');let sc=0;
 arr.forEach((qObj,idx)=>{
  shuffle(qObj.choices);
  const blk=document.createElement('div');blk.className='block';
  blk.innerHTML=`<p>${idx+1}. ${qObj.question}</p>`;
  const optWrap=document.createElement('div');optWrap.style.display='grid';optWrap.style.gap='.75rem';
  const opts=[];
  qObj.choices.forEach(c=>{
    const btn=document.createElement('button');btn.className='btn option';btn.textContent=c;
    btn.onclick=()=>{
      opts.forEach(o=>{o.disabled=true;o.classList.add('disabled')});
      btn.classList.add(c===qObj.answer?'correct':'wrong');
      if(c===qObj.answer)sc++;else opts.find(o=>o.textContent===qObj.answer).classList.add('correct');
      score.textContent=`Score ${sc}/${arr.length}`;
    };
    opts.push(btn);optWrap.appendChild(btn);
  });
  const askBtn=document.createElement('button');askBtn.className='btn ghost';askBtn.textContent='Ask ChatGPT';
  askBtn.onclick=()=>ask(`Multiple-choice question on process mining:\n${qObj.question}\nOptions: ${qObj.choices.join(', ')}\nExplain why the correct answer ("${qObj.answer}") is right and others are wrong.`);
  blk.append(optWrap,askBtn);wrap.appendChild(blk);
 });
 if(window.hljs) window.hljs.highlightAll();
})();

/* WRITTEN */
(async()=>{
 const arr=(await dataPromise).writtenAnswer;shuffle(arr);let i=0;
 const q=$('#waQ'),aBox=$('#waA'),tBtn=$('#waToggle');

 const render=()=>{
   renderMD(q, arr[i].q);
   aBox.innerHTML='';
   aBox.classList.remove('expanded');
   tBtn.classList.remove('active');
   tBtn.textContent='Correct answer';
 };
 render();

 tBtn.onclick=()=>{
   const expanded=aBox.classList.contains('expanded');
   if(!expanded) renderMD(aBox, arr[i].a);
   aBox.classList.toggle('expanded');
   tBtn.classList.toggle('active');
 };

 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#waPrev').onclick=prev;
 $('#waNext').onclick=next;
 addSwipe($('#written'),next,prev);
 $('#waAsk').onclick=()=>ask(`I'm studying process mining. Could you explain the following question for me?\n"${arr[i].q}"\n\nThe correct answer is: "${arr[i].a}"`);
})();

/* TRUE/FALSE */
(async()=>{
 const arr=(await dataPromise).trueFalse;shuffle(arr);let i=0;
 const q=$('#tfQ'),btns=$$('#tf button.option');
 const render=()=>{
   renderMD(q, arr[i].q);
   btns.forEach(b=>{b.disabled=false;b.classList.remove('correct','wrong','disabled')});
 };
 btns.forEach(b=>b.onclick=()=>{
  const ans=b.dataset.val==='true',ok=arr[i].a;
  btns.forEach(x=>{x.disabled=true;x.classList.add('disabled')});
  b.classList.add(ans===ok?'correct':'wrong');
 });
 const prev=()=>{i=(i-1+arr.length)%arr.length;render()};
 const next=()=>{i=(i+1)%arr.length;render()};
 $('#tfPrev').onclick=prev;
 $('#tfNext').onclick=next;
 addSwipe($('#tf'),next,prev);
 $('#tfAsk').onclick=()=>ask(`Is the following statement about process mining true or false? Explain.\n"${arr[i].q}"\n\nThe correct answer is: ${arr[i].a ? "True" : "False"}`);
 render();
})();

/* NOTES + floating ask */
(async()=>{
 const box=$('#notesBox');renderMD(box, await (await fetch('notes.md')).text());
 const float=$('#selAsk');
 const updateFloatPosition=()=>{
  const sel=getSelection();
  if(!sel||sel.isCollapsed||!box.contains(sel.anchorNode)){float.style.display='none';return;}
  const r=sel.getRangeAt(0).getBoundingClientRect();
  if(!r.width&&!r.height){float.style.display='none';return;}
  float.style.position='fixed';
  float.style.top=`${r.bottom+8}px`;
  float.style.left=`${r.left}px`;
  float.style.display='block';
  const fr=float.getBoundingClientRect(),vw=document.documentElement.clientWidth;
  if(fr.right>vw)float.style.left=`${vw-fr.width-10}px`;
 };
 document.addEventListener('selectionchange',updateFloatPosition);
 document.addEventListener('touchend',()=>setTimeout(updateFloatPosition,100));
 document.addEventListener('scroll',()=>{if(getSelection()&&!getSelection().isCollapsed)updateFloatPosition()});
 window.addEventListener('resize',()=>{if(getSelection()&&!getSelection().isCollapsed)updateFloatPosition()});
 float.onclick=()=>{const txt=getSelection().toString().trim();if(txt)ask(`Explain this excerpt from my notes on process mining:\n"${txt}"`)};
})();

/* ---------- the rest of your original JS (parkour, swipe, etc.) stays unchanged ---------- */
</script>
</body>
</html>